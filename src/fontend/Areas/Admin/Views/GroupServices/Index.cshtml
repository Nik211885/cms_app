@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@
@{
    ViewData["Title"] = "Nhóm dịch vụ";
    Layout = "~/Areas/Admin/Views/Shared/_LayoutAdmin.cshtml";

}
@*
    For more information on enabling MVC for empty projects, visit https://go.microsoft.com/fwlink/?LinkID=397860
*@

<div class="content container-fluid">
    <div id="successMessage" class="bg-success px-2 rounded my-2 text-center text-white " style="display: none;">
    Gửi duyệt thành công
</div>
<div class="content container-fluid">
    <div id="saveSuccessMessage" class="bg-secondary px-2 rounded my-2 text-center text-white " style="display: none;">
    Lưu lại thành công
</div>
    <div class="card">
        <div class="content container-fluid">
            <div class="contact-profile">
                <div class="row align-items-center">
                    <div class="col-md-4">
                        <h3 class="page-title">Nhóm dịch vụ</h3>
                        <ul class="breadcrumb">
                            <li class="breadcrumb-item"><a href="">Trang chủ</a></li>
                            <li class="breadcrumb-item active">Nhóm dịch vụ</li>
                        </ul>
                    </div>
                    <div class="col-md-8 float-end ms-auto">
                        <div class="d-flex title-head">
                            <button  id="postServicesNews" class="btn add-btn btn-primary btn-sm mx-2" data-bs-toggle="modal" data-bs-target="#add_groupservices" ><i class="la la-plus-circle" ></i>Tạo nhóm dịch vụ mới</button>
                            <button class="text-white border-secondar bg-secondary rounded btn btn-sm mx-1"  onclick="window.history.back()"><i class="fa-solid fa-arrow-left"></i> Quay lại</button>
                            @* <a href="/admin/servicesnews/create" class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#addModal"><i class="la la-plus-circle"></i>  Thêm mới</a> *@

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="card">
        <div class="content container-fluid">
            <div class="row">
                    <div class="col-md-12">
                        <div class="table-responsive">
                            <table id="myTable" class="table table-striped table-bordered fw-bold" style="width:100%" >
                                <thead class="thead-dark">
                                    <tr>
                                        <th>STT</th>
                                        <th>Nhóm dịch vụ</th> 
                                        <th>Ngày tạo</th>
                                        <th>Hành động</th>
                                    </tr>
                                </thead>
                                <tbody></tbody>
                            </table>

                        </div>
                    </div>
            </div>
        </div>
    </div>
</div>
<div class="modal custom-modal fade" id="add_groupservices" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered d-flex align-items-start" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Tạo Nhóm Dịch Vụ</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">×</span>
</button>            </div>
            <div class="modal-body">
                <!-- Nút để chuyển giữa form cha và con -->
                <div class="d-flex justify-content-around mb-3">
                    <button id="createParentService" class="btn btn-outline-primary btn-primary btn-sm rounded" >Tạo Nhóm Dịch Vụ Cha</button>
                    <button id="createChildService" class="btn btn-outline-primary btn-sm rounded">Tạo Nhóm Dịch Vụ Con</button>
                </div>

                <!-- Form tạo nhóm dịch vụ cha -->
                <div id="parentForm" class="form-section">
                    <form>
                        <div class="col-sm-12 mb-3">
                        <label class="form-label"><b>Tên nhóm cha: </b><span style="color:red">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="las la-font"></i></span>
                            <input type="text" class="form-control form-control-sm" id="title" name="title" placeholder="Nhập tên nhóm cha"  />
                        </div>
                        <div class="error-message text-danger text-sm mt-1" id="error-title"></div>
                    </div>
                        <div class="submit-section">
                            <a class="btn btn-primary btn-sm mx-1">Tạo mới nhóm</a>
                        </div>
                    </form>
                </div>

                <!-- Form tạo nhóm dịch vụ con -->
                <div id="childForm" class="form-section" style="display: none;">
                    <form>
                        <div class=" mb-2 style="width: 100%;"">
                        <label for="parent-select" class="fw-bold">Chọn nhóm cha: </label> <span style="color:red">*</span>
                        <select id="parent-select" class="border border-light-subtle rounded py-1" style="width: 100%;">
                            <option value="">--Lựa chọn--</option>
                            <option value="parent1">Chứng nhận hệ thống quản lý</option>
                            <option value="parent2">Chứng nhận sản phẩm hợp chuẩn</option>
                            <option value="parent3">Chứng nhận sản phẩm hợp quy</option>
                            <option value="parent4">VIETGAP</option>
                        </select>
        
                    </div>
                         <div class="col-sm-12 mb-3">
                        <label class="form-label"><b>Tên nhóm con </b><span style="color:red">*</span></label>
                        <div class="input-group">
                            <span class="input-group-text"><i class="las la-font"></i></span>
                            <input type="text" class="form-control form-control-sm" id="title" name="title" placeholder="Nhập tên nhóm con"  />
                        </div>
                        <div class="error-message text-danger text-sm mt-1" id="error-title"></div>
                    </div>
                        <div class="submit-section">
                            <a class="btn btn-primary btn-sm mx-1">Tạo mới nhóm</a>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>




<script src="~/js/jquery-3.7.1.min.js"></script>
<script src="~/js/select2.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>


<script>
    $(document).ready(function(){

       $('#createParentService').click(function() {
        // Hiển thị form cha và ẩn form con
        $('#parentForm').css('display', 'block');
        $('#childForm').css('display', 'none');

        // Thêm class 'btn-primary' cho nút được chọn và đổi class của nút không được chọn
        $(this).removeClass('btn-outline-primary').addClass('btn-primary');
        $('#createChildService').removeClass('btn-primary').addClass('btn-outline-primary');
    });

    // Khi click vào nút Tạo Nhóm Dịch Vụ Con
    $('#createChildService').click(function() {
        // Hiển thị form con và ẩn form cha
        $('#parentForm').css('display', 'none');
        $('#childForm').css('display', 'block');

        // Thêm class 'btn-primary' cho nút được chọn và đổi class của nút không được chọn
        $(this).removeClass('btn-outline-primary').addClass('btn-primary');
        $('#createParentService').removeClass('btn-primary').addClass('btn-outline-primary');
    });
         
            // Dữ liệu danh mục con theo từng danh mục cha
            var childOptions = {
                parent1: [
                    { id: '1', text: 'ISO9001 '},
                    { id: '2', text: 'ISO7001' },
                    { id: '3', text: 'ISO112' },
                    { id: '4', text: 'ISO222' },
                    { id: '5', text: 'ISO4455' }
                ],
                parent3: [
                    { id: '3', text: 'Xăng' },
                    { id: '4', text: 'Nhiên liệu sinh học' }
                ],
                 parent4: [
                    { id: '5', text: 'Chăn nuôi' },
                    { id: '6', text: 'Trồng trọt' },
                    { id: '7', text: 'Thủy sản' }
                ]
            };

            // Khi chọn danh mục cha
            $('#parent-select').on('change', function() {
                var parentValue = $(this).val(); // Lấy giá trị đã chọn của danh mục cha
                var childSelect = $('#child-select');

                // Xóa các tùy chọn cũ của danh mục con
                childSelect.empty();

                // Nếu có danh mục cha được chọn
                if (parentValue) {
                    // Thêm các tùy chọn con mới dựa trên danh mục cha
                    $.each(childOptions[parentValue], function(key, value) {
                        childSelect.append(new Option(value.text, value.id));
                    });
                }

                // Cập nhật lại Select2 cho danh mục con
                childSelect.trigger('change');
            });
  


var table = $('#myTable').DataTable({
    ajax: {
        url: 'http://localhost:3001/danhsachtindichvu', // Đường dẫn đến file JSON
        dataSrc: 'data.data' // Cập nhật để lấy dữ liệu từ `data.data`
    },
    columns: [
        {
            data: 'id', // Cột ID
            render: function(data, type, row) {
                return '<div class="text-center">' + data + '</div>';
            }
        },
        { data: 'title' }, // Cột Tiêu đề
        {
            data: 'contentTitle', // Sử dụng contentTitle để hiển thị
            render: function(data, type, row) {
                // Trả về chuỗi các tiêu đề nội dung, đã bỏ dấu ngoặc vuông và cách nhau bằng dấu phẩy
                return data; // Dữ liệu đã có định dạng phù hợp
            }
        },
        
        {
            data: null, // Không lấy dữ liệu từ JSON
            className: 'text-center', // Căn giữa cho cột
            render: function(data, type, row) {
                // Nút ba chấm với menu thả xuống
                return `
                    <div class="dropdown">
                        <button class="" type="button" id="actionMenu" data-bs-toggle="dropdown" aria-expanded="false" style="border:none;background-color:inherit">
                            <i class="fa-solid fa-ellipsis-vertical fs-5" style="color: #000000;"></i>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="actionMenu">
                            <li class="d-flex align-items-center"><a class="dropdown-item btn-edit" href="#" data-id="${row.id}"><i class="fa-solid fa-pen mx-1" style="color: #0c0d0d;"></i> Sửa</a></li>
                            <li class="d-flex align-items-center"><a class="dropdown-item btn-delete" href="#" data-id="${row.id}"><i class="fa-solid fa-trash mx-1" style="color: #1b1c1d;"></i> Xóa</a></li>
                        </ul>
                    </div>
                `;
            }
        }
    ]
});

// Xử lý sự kiện Sửa
$('#myTable').on('click', '.btn-edit', function() {
    var id = $(this).data('id');
    // Chuyển hướng đến trang edit với ID của item
    window.location.href = `servicesnews/edit/${id}`;
});
// Xử lý sự kiện Xóa
$('#myTable').on('click', '.btn-delete', function() {
    var id = $(this).data('id');
    // Thêm logic để xóa
    console.log('Xóa item ID:', id);
});
    });
</script>